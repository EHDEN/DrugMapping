SELECT DRUGCOMP.CONCEPT_ID AS DRUGCOMP_CONCEPT_ID,
       DRUGCOMP.CONCEPT_NAME AS DRUGCOMP_CONCEPT_NAME,
       DRUGCOMP.DOMAIN_ID AS DRUGCOMP_DOMAIN_ID,
       DRUGCOMP.VOCABULARY_ID AS DRUGCOMP_VOCABULARY_ID,
       DRUGCOMP.CONCEPT_CLASS_ID AS DRUGCOMP_CONCEPT_CLASS_ID,
       DRUGCOMP.STANDARD_CONCEPT AS DRUGCOMP_STANDARD_CONCEPT,
       DRUGCOMP.CONCEPT_CODE AS DRUGCOMP_CONCEPT_CODE,
       DRUGCOMP.VALID_START_DATE AS DRUGCOMP_VALID_START_DATE,
       DRUGCOMP.VALID_END_DATE AS DRUGCOMP_VALID_END_DATE,
       DRUGCOMP.INVALID_REASON AS DRUGCOMP_INVALID_REASON,
       STRENGTH.AMOUNT_VALUE,
       STRENGTH.AMOUNT_UNIT_CONCEPT_ID,
       AMOUNT_UNIT.CONCEPT_NAME AS AMOUNT_UNIT_CONCEPT_NAME,
       AMOUNT_UNIT.DOMAIN_ID AS AMOUNT_UNIT_DOMAIN_ID,
       AMOUNT_UNIT.VOCABULARY_ID AS AMOUNT_UNIT_VOCABULARY_ID,
       AMOUNT_UNIT.CONCEPT_CLASS_ID AS AMOUNT_UNIT_CONCEPT_CLASS_ID,
       AMOUNT_UNIT.STANDARD_CONCEPT AS AMOUNT_UNIT_STANDARD_CONCEPT,
       AMOUNT_UNIT.CONCEPT_CODE AS AMOUNT_UNIT_CONCEPT_CODE,
       AMOUNT_UNIT.VALID_START_DATE AS AMOUNT_UNIT_VALID_START_DATE,
       AMOUNT_UNIT.VALID_END_DATE AS AMOUNT_UNIT_VALID_END_DATE,
       AMOUNT_UNIT.INVALID_REASON AS AMOUNT_UNIT_INVALID_REASON,
       STRENGTH.NUMERATOR_VALUE,
       STRENGTH.NUMERATOR_UNIT_CONCEPT_ID,
       NUMERATOR_UNIT.CONCEPT_NAME AS NUMERATOR_UNIT_CONCEPT_NAME,
       NUMERATOR_UNIT.DOMAIN_ID AS NUMERATOR_UNIT_DOMAIN_ID,
       NUMERATOR_UNIT.VOCABULARY_ID AS NUMERATOR_UNIT_VOCABULARY_ID,
       NUMERATOR_UNIT.CONCEPT_CLASS_ID AS NUMERATOR_UNIT_CONCEPT_CLASS_ID,
       NUMERATOR_UNIT.STANDARD_CONCEPT AS NUMERATOR_UNIT_STANDARD_CONCEPT,
       NUMERATOR_UNIT.CONCEPT_CODE AS NUMERATOR_UNIT_CONCEPT_CODE,
       NUMERATOR_UNIT.VALID_START_DATE AS NUMERATOR_UNIT_VALID_START_DATE,
       NUMERATOR_UNIT.VALID_END_DATE AS NUMERATOR_UNIT_VALID_END_DATE,
       NUMERATOR_UNIT.INVALID_REASON AS NUMERATOR_UNIT_INVALID_REASON,
       STRENGTH.DENOMINATOR_VALUE,
       STRENGTH.DENOMINATOR_UNIT_CONCEPT_ID,
       DENOMINATOR_UNIT.CONCEPT_NAME AS DENOMINATOR_UNIT_CONCEPT_NAME,
       DENOMINATOR_UNIT.DOMAIN_ID AS DENOMINATOR_UNIT_DOMAIN_ID,
       DENOMINATOR_UNIT.VOCABULARY_ID AS DENOMINATOR_UNIT_VOCABULARY_ID,
       DENOMINATOR_UNIT.CONCEPT_CLASS_ID AS DENOMINATOR_UNIT_CONCEPT_CLASS_ID,
       DENOMINATOR_UNIT.STANDARD_CONCEPT AS DENOMINATOR_UNIT_STANDARD_CONCEPT,
       DENOMINATOR_UNIT.CONCEPT_CODE AS DENOMINATOR_UNIT_CONCEPT_CODE,
       DENOMINATOR_UNIT.VALID_START_DATE AS DENOMINATOR_UNIT_VALID_START_DATE,
       DENOMINATOR_UNIT.VALID_END_DATE AS DENOMINATOR_UNIT_VALID_END_DATE,
       DENOMINATOR_UNIT.INVALID_REASON AS DENOMINATOR_UNIT_INVALID_REASON,
       STRENGTH.BOX_SIZE,
       STRENGTH.INGREDIENT_CONCEPT_ID
FROM @vocab.CONCEPT DRUGCOMP
  INNER JOIN @vocab.DRUG_STRENGTH STRENGTH
    ON STRENGTH.DRUG_CONCEPT_ID = DRUGCOMP.CONCEPT_ID
  LEFT OUTER JOIN @vocab.CONCEPT AMOUNT_UNIT
    ON STRENGTH.AMOUNT_UNIT_CONCEPT_ID = AMOUNT_UNIT.CONCEPT_ID
  LEFT OUTER JOIN @vocab.CONCEPT NUMERATOR_UNIT
    ON STRENGTH.NUMERATOR_UNIT_CONCEPT_ID = NUMERATOR_UNIT.CONCEPT_ID
  LEFT OUTER JOIN @vocab.CONCEPT DENOMINATOR_UNIT
    ON STRENGTH.DENOMINATOR_UNIT_CONCEPT_ID = DENOMINATOR_UNIT.CONCEPT_ID
WHERE DRUGCOMP.DOMAIN_ID = 'Drug'
AND   UPPER(DRUGCOMP.VOCABULARY_ID) LIKE 'RXNORM%'
AND   DRUGCOMP.CONCEPT_CLASS_ID = 'Clinical Drug Comp'
AND   DRUGCOMP.STANDARD_CONCEPT = 'S'
-- AND   DRUGCOMP.INVALID_REASON IS NULL
GROUP BY DRUGCOMP.CONCEPT_ID,
         DRUGCOMP.CONCEPT_NAME,
         DRUGCOMP.DOMAIN_ID,
         DRUGCOMP.VOCABULARY_ID,
         DRUGCOMP.CONCEPT_CLASS_ID,
         DRUGCOMP.STANDARD_CONCEPT,
         DRUGCOMP.CONCEPT_CODE,
         DRUGCOMP.VALID_START_DATE,
         DRUGCOMP.VALID_END_DATE,
         DRUGCOMP.INVALID_REASON,
         STRENGTH.AMOUNT_VALUE,
         STRENGTH.AMOUNT_UNIT_CONCEPT_ID,
         AMOUNT_UNIT.CONCEPT_NAME,
         AMOUNT_UNIT.DOMAIN_ID,
         AMOUNT_UNIT.VOCABULARY_ID,
         AMOUNT_UNIT.CONCEPT_CLASS_ID,
         AMOUNT_UNIT.STANDARD_CONCEPT,
         AMOUNT_UNIT.CONCEPT_CODE,
         AMOUNT_UNIT.VALID_START_DATE,
         AMOUNT_UNIT.VALID_END_DATE,
         AMOUNT_UNIT.INVALID_REASON,
         STRENGTH.NUMERATOR_VALUE,
         STRENGTH.NUMERATOR_UNIT_CONCEPT_ID,
         NUMERATOR_UNIT.CONCEPT_NAME,
         NUMERATOR_UNIT.DOMAIN_ID,
         NUMERATOR_UNIT.VOCABULARY_ID,
         NUMERATOR_UNIT.CONCEPT_CLASS_ID,
         NUMERATOR_UNIT.STANDARD_CONCEPT,
         NUMERATOR_UNIT.CONCEPT_CODE,
         NUMERATOR_UNIT.VALID_START_DATE,
         NUMERATOR_UNIT.VALID_END_DATE,
         NUMERATOR_UNIT.INVALID_REASON,
         STRENGTH.DENOMINATOR_VALUE,
         STRENGTH.DENOMINATOR_UNIT_CONCEPT_ID,
         DENOMINATOR_UNIT.CONCEPT_NAME,
         DENOMINATOR_UNIT.DOMAIN_ID,
         DENOMINATOR_UNIT.VOCABULARY_ID,
         DENOMINATOR_UNIT.CONCEPT_CLASS_ID,
         DENOMINATOR_UNIT.STANDARD_CONCEPT,
         DENOMINATOR_UNIT.CONCEPT_CODE,
         DENOMINATOR_UNIT.VALID_START_DATE,
         DENOMINATOR_UNIT.VALID_END_DATE,
         DENOMINATOR_UNIT.INVALID_REASON,
         STRENGTH.BOX_SIZE,
         STRENGTH.INGREDIENT_CONCEPT_ID
ORDER BY DRUGCOMP.CONCEPT_ID,
         STRENGTH.INGREDIENT_CONCEPT_ID